A singleton is a design pattern that restricts the instantiation of a class to one object, or just a single instance, hence, singleton. Most of the time, you won't always need this, but this pattern becomes useful for objects that manage coordination or state over the lifetime of your particular application. So what do we mean by things that manage coordination, or state? Okay, a general example is say you have a class that loads in configuration and in essence determines the global state of your application.

Are we in production or development? What is the database connections? What timezone are we in? How should we format numbers? These questions need to be answered the same way every time for the entire time our application is running. Let's look at creating a singleton now. Making a singleton involves a fair bit of code. So I've gone ahead and done some of this for you already. In the course exercise files, there's a snippets.txt file. You wanna open that, copy that, and paste it as a new file in your oop directory, that will save as "singleton.php".
Let's walk through exactly what this file is doing, and how we're using our singleton. At the top, on line two, we declare a normal new class singleton. Next, we have a protected static variable instance on line six. This is the single instance of this class that we'll use throughout our entire application. Our first method is a static getInstance method on line 13. This method either returns a new instance of the class if none exists on line 16, or returns only the instance already created on line 19.


We next mark the construct method as protected to ensure that the only way that a new instance of the singleton can be created, via the new method, is inside of the class itself. We've marked the clone method, which we'll talk about a bit later as private to ensure we can't create copies of the class as well. And finally, the wakeup method is marked as private as well to ensure that the class can not be unserialized. Okay, let's look at a child of our singleton class. On line 51, we create a child instance called SingletonChild.


This SingletonChild class is going to let us verify that we are only creating one instance of every class. On line 55, we can start exploring the ability that this singleton pattern gives us. First up, we get an instance of our singleton and compare it to a new instance of the singleton, itself on line 56. In this case, we expect it to return true. As every time that we get an instance of the singleton object, we should get the exact same object back. What about the child? Is the child instance the same as the parent instance? Well, no.


On line 58 we get a new instance of the child object. And on line 59 we compare that child instance to the instance of the parent singleton. In this case, it should return false. However, if we again repeat the pattern of comparing the child instance that we've already created, to a new instance of the singleton child, that should always return true. Again, singleton objects should only return as single instance of themselves for the lifetime of the entire application.


Let's run this code, and verify that it all works. We'll go over to our terminal application, and run the command php in the directory oop/singleton.php and yes, we get true, false, and then true. Exactly what we expected. Singletons may not be a thing that you'll always want to use and you shouldn't use them all the time. It could be very easy to over-use. But if you ever find yourself needing to ensure you have only one instance of a class, such as for configuration or database connections, look to the singleton as a solution.
